version: "2"
services:
# 暂时不用
    # redis:
    #   image: redis:alpine
    #   container_name: swapsy-redis
    mysql:
      build:
        context: 'phpdocker/mysql'
        dockerfile: Dockerfile
      container_name: swapsy-mysql
      working_dir: /var/lib/mysql
      command: mysqld --sql_mode=""
      volumes:
        - ./app/db/mysql:/var/lib/mysql
      environment:
        - MYSQL_ROOT_PASSWORD=pass
        - MYSQL_DATABASE=db
      ports:
        - "13306:3306"
      # command: mysqld --sql_mode="(SELECT REPLACE(@@sql_mode,'ONLY_FULL_GROUP_BY',''))"
      restart: always
    webserver:
      image: nginx:alpine
      container_name: swapsy-webserver
      working_dir: /var/www/html/web
      volumes:
        - ./phpdocker/nginx/nginx.conf:/etc/nginx/conf.d/default.conf
        - ./app/nginx/log:/var/log/nginx
      ports:
        - "4443:4443"
        - "4444:4444"
        - "4445:4445"
        - "4446:4446"
      depends_on:
        - php
      volumes_from:
        - php
      networks:
        default:
          aliases:
            - backend.dev
            - frontend.dev
      # link: mysql
    php:
      build: phpdocker/php-fpm
      container_name: swapsy-php-fpm
      working_dir: /var/www/html/web/swapsy
      volumes:
        - ./../swapsy:/var/www/html/web/swapsy
        - ./phpdocker/php-fpm/php-ini-overrides.ini:/usr/local/etc/php/conf.d/99-overrides.ini
        - ./../phpmyadmin:/var/www/html/web/phpmyadmin
      depends_on:
        - mysql
      environment:
        PHP_EXTENSION_XDEBUG: 1
        XDEBUG_CONFIG: "remote_enable=1 remote_port=9099 remote_host=192.168.0.8 remote_connect_back=0 remote_autostart=1 var_display_max_data=1024 var_display_max_depth=5"
        # PHP_IDE_CONFIG: "serverName=dock-debug-server"